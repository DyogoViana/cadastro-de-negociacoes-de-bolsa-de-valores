{"version":3,"sources":["../../app-es6/DAO/NegociacaoDAO.js"],"names":["Negociacao","NegociacaoDAO","connection","_connection","_store","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","event","onerror","console","log","target","error","cursor","openCursor","negociacoes","atual","result","dado","value","push","_data","_quantidade","_valor","continue","clear"],"mappings":";;;;;;;;;;;;;;;AAGSA,sB,qBAAAA,U;;;;;;;;;;;;;;;;;;;;;qCAEIC,a;AAET,uCAAYC,UAAZ,EAAwB;AAAA;;AACpB,yBAAKC,WAAL,GAAmBD,UAAnB;AACA,yBAAKE,MAAL,GAAc,aAAd;AACH;;AAED;;;;;6CACSC,U,EAAY;AAAA;;AACjB,+BAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;;AAEpC,gCAAIC,UAAU,MAAKN,WAAL,CACZO,WADY,CACA,CAAC,MAAKN,MAAN,CADA,EACe,WADf,EAEZO,WAFY,CAEA,MAAKP,MAFL,EAGZQ,GAHY,CAGRP,UAHQ,CAAd;;AAKAI,oCAAQI,SAAR,GAAoB,UAACC,KAAD,EAAW;AAC3BP;AACF,6BAFF;;AAIAE,oCAAQM,OAAR,GAAkB,iBAAS;AACvBC,wCAAQC,GAAR,CAAYH,MAAMI,MAAN,CAAaC,KAAzB;AACAX,uCAAO,0CAAP;AACF,6BAHF;AAIH,yBAfM,CAAP;AAgBH;;;iDAGY;AAAA;;AAET,+BAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;;AAEpC,gCAAIY,SAAS,OAAKjB,WAAL,CACXO,WADW,CACC,CAAC,OAAKN,MAAN,CADD,EACe,WADf,EAEXO,WAFW,CAEC,OAAKP,MAFN,EAGXiB,UAHW,EAAb;;AAKA,gCAAIC,cAAc,EAAlB;;AAEAF,mCAAOP,SAAP,GAAmB,iBAAS;AACvB,oCAAIU,QAAQT,MAAMI,MAAN,CAAaM,MAAzB;;AAEA,oCAAGD,KAAH,EAAU;AAAE;AACR,wCAAIE,OAAOF,MAAMG,KAAjB;;AAEAJ,gDAAYK,IAAZ,CAAiB,IAAI3B,UAAJ,CAAgByB,KAAKG,KAArB,EAA6BH,KAAKI,WAAlC,EAA+CJ,KAAKK,MAApD,CAAjB;AACAP,0CAAMQ,QAAN;AAEH,iCAND,MAMO;AACJxB,4CAAQe,WAAR;AACF;AACL,6BAZD;;AAcAF,mCAAOL,OAAP,GAAiB,iBAAS;AACtBC,wCAAQC,GAAR,CAAYH,MAAMI,MAAN,CAAaC,KAAzB;AACAX,uCAAO,wCAAP;AACH,6BAHD;AAIH,yBA3BM,CAAP;AA4BH;;;iDAGY;AAAA;;AAET,+BAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;;AAEpC,gCAAIC,UAAU,OAAKN,WAAL,CACZO,WADY,CACA,CAAC,OAAKN,MAAN,CADA,EACe,WADf,EAEZO,WAFY,CAEA,OAAKP,MAFL,EAGZ4B,KAHY,EAAd;;AAKCvB,oCAAQI,SAAR,GAAoB;AAAA,uCAASN,QAAQ,kCAAR,CAAT;AAAA,6BAApB;;AAEAE,oCAAQM,OAAR,GAAkB,iBAAS;AACvBC,wCAAQC,GAAR,CAAYH,MAAMI,MAAN,CAAaC,KAAzB;AACAX,uCAAO,0CAAP;AACH,6BAHD;AAIJ,yBAbM,CAAP;AAcH","file":"NegociacaoDAO.js","sourcesContent":["// NegociacaoDAO.js -- DAO 'Data Access Object'.\r\n\r\n\r\nimport { Negociacao } from \"../models/Negociacao\";\r\n\r\nexport class NegociacaoDAO {\r\n\r\n    constructor(connection) {\r\n        this._connection = connection;\r\n        this._store = \"negociacoes\";\r\n    }\r\n\r\n    // Adiciona uma nova transação de negociação no banco de dados.\r\n    adiciona(negociacao) {\r\n        return new Promise((resolve, reject) => {\r\n\r\n            let request = this._connection\r\n             .transaction([this._store], \"readwrite\")\r\n             .objectStore(this._store)\r\n             .add(negociacao);\r\n\r\n            request.onsuccess = (event) => {\r\n                resolve();\r\n             };\r\n\r\n            request.onerror = event => {\r\n                console.log(event.target.error);\r\n                reject(\"Não foi possível adicionar a negociação.\");\r\n             };\r\n        });\r\n    }\r\n\r\n    // Lista todas as negociações na view.\r\n    listaTodos() {\r\n\r\n        return new Promise((resolve, reject) => {\r\n\r\n            let cursor = this._connection\r\n             .transaction([this._store],'readwrite')\r\n             .objectStore(this._store)\r\n             .openCursor();\r\n\r\n            let negociacoes = [];\r\n\r\n            cursor.onsuccess = event => {\r\n                 let atual = event.target.result;\r\n\r\n                 if(atual) { // Se o ponteiro existir, ele pega o dado.\r\n                     let dado = atual.value;\r\n\r\n                     negociacoes.push(new Negociacao((dado._data), dado._quantidade, dado._valor));\r\n                     atual.continue();\r\n\r\n                 } else { \r\n                    resolve(negociacoes);\r\n                 }\r\n            };\r\n\r\n            cursor.onerror = event => {\r\n                console.log(event.target.error);\r\n                reject(\"Não foi posível listar as negociações.\");\r\n            };\r\n        });\r\n    }\r\n\r\n    // Apaga a lista de negociações da view e do banco.\r\n    apagaTodos() {\r\n        \r\n        return new Promise((resolve, reject) => {\r\n\r\n            let request = this._connection\r\n             .transaction([this._store], \"readwrite\")\r\n             .objectStore(this._store)\r\n             .clear();\r\n\r\n             request.onsuccess = event => resolve(\"Negociaçõs apagadas com sucesso.\");\r\n\r\n             request.onerror = event => {\r\n                 console.log(event.target.error);\r\n                 reject(\"Não foi possível remover as negociações.\");\r\n             } \r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n-------------------------------------------------------------------------\r\n-------------------------------------------------------------------------\r\n\r\n\r\n    # Anotações\r\n\r\n    - O 'cursor' é o responsável por passear pelos dados da Object Store. Ele tem um ponteiro para o primeiro, segundo e os demais elementos ordenados.\r\n\r\n    - \r\n\r\n\r\n-------------------------------------------------------------------------\r\n-------------------------------------------------------------------------\r\n*/"]}